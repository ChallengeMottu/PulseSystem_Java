<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Cadastro de Usuário</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/register.css}" />
    <meta charset="UTF-8">
</head>
<body>
<div class="form-container">
    <h2>Cadastro de Usuário</h2>

    <!-- Mensagens gerais -->
    <div th:if="${success}" class="success-message">
        <p th:text="${success}"></p>
    </div>

    <div th:if="${errorMessage}" class="error-message">
        <p th:text="${errorMessage}"></p>
    </div>

    <form th:action="@{/users/register}" th:object="${user}" method="post" class="horizontal-form">
        <div class="form-row">
            <!-- Linha 1: Nome e CPF -->
            <div class="form-group">
                <label>Nome:</label>
                <input type="text" th:field="*{name}" required
                       placeholder="Digite o nome completo"
                       class="form-input" />
                <div th:if="${#fields.hasErrors('name')}" class="field-error">
                    <span th:errors="*{name}"></span>
                </div>
            </div>

            <div class="form-group">
                <label>CPF:</label>
                <input type="text" th:field="*{cpf}" required
                       placeholder="000.000.000-00"
                       class="form-input" />
                <div th:if="${#fields.hasErrors('cpf')}" class="field-error">
                    <span th:errors="*{cpf}"></span>
                </div>
            </div>
        </div>

        <div class="form-row">
            <!-- Linha 2: Data Nascimento e Email -->
            <div class="form-group">
                <label>Data de nascimento:</label>
                <input type="date" th:field="*{birthDate}" required
                       class="form-input" />
                <div th:if="${#fields.hasErrors('birthDate')}" class="field-error">
                    <span th:errors="*{birthDate}"></span>
                </div>
            </div>

            <div class="form-group">
                <label>Email:</label>
                <input type="email" th:field="*{email}" required
                       placeholder="exemplo@email.com"
                       class="form-input" />
                <div th:if="${#fields.hasErrors('email')}" class="field-error">
                    <span th:errors="*{email}"></span>
                </div>
            </div>
        </div>

        <div class="form-row">
            <!-- Linha 3: Senha e Confirmar Senha -->
            <div class="form-group">
                <label>Senha:</label>
                <input type="password" th:field="*{password}" required
                       placeholder="Mínimo 6 caracteres"
                       class="form-input" />
                <div th:if="${#fields.hasErrors('password')}" class="field-error">
                    <span th:errors="*{password}"></span>
                </div>
            </div>

            <div class="form-group">
                <label>Perfil:</label>
                <select th:field="*{role}" required class="form-input">
                    <option value="">Selecione o perfil</option>
                    <option th:value="GESTOR">Gestor</option>
                    <option th:value="MECANICO">Mecânico</option>
                    <option th:value="OPERADOR">Operador</option>
                </select>
                <div th:if="${#fields.hasErrors('role')}" class="field-error">
                    <span th:errors="*{role}"></span>
                </div>
            </div>
        </div>

        <div class="form-row">

            <div class="form-group full-width">
                <label>Pátio:</label>
                <input type="number" th:field="*{parkingId}"
                       placeholder="ID do pátio (opcional)"
                       class="form-input" />
                <div th:if="${#fields.hasErrors('parkingId')}" class="field-error">
                    <span th:errors="*{parkingId}"></span>
                </div>
                <small class="hint">* Campo opcional</small>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn-primary">Cadastrar</button>
            <a th:href="@{/users/list}" class="cancel-btn">Cancelar</a>
        </div>
    </form>
</div>

<script>
    // Máscara para CPF
    document.addEventListener('DOMContentLoaded', function() {
        const cpfInput = document.querySelector('input[th\\:field="*{cpf}"]');
        if (cpfInput) {
            cpfInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length <= 11) {
                    value = value.replace(/(\d{3})(\d)/, '$1.$2')
                        .replace(/(\d{3})(\d)/, '$1.$2')
                        .replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                }
                e.target.value = value;
            });
        }

        // Foco no primeiro campo com erro
        const firstError = document.querySelector('.field-error');
        if (firstError) {
            const input = firstError.previousElementSibling;
            if (input && input.classList.contains('form-input')) {
                input.focus();
                input.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
    });
</script>
</body>
</html>